stage('Remove Budget Resource From State (if present)') {
  steps {
    dir('budget_alert') {
      sh '''
        if terraform state list | grep -q azurerm_consumption_budget_resource_group.budget; then
          echo "Removing budget resource from state..."
          terraform state rm azurerm_consumption_budget_resource_group.budget
        else
          echo "Budget resource not found in state, skipping remove."
        fi
      '''
    }
  }
}
